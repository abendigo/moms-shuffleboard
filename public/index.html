<!DOCTYPE html>
<html>
  <head>
    <!-- <link href='https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons' rel="stylesheet"> -->
    <!-- <link href="https://cdn.jsdelivr.net/npm/vuetify/dist/vuetify.min.css" rel="stylesheet"> -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">

    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
    <script src="https://unpkg.com/vuex/dist/vuex.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/vuetify/dist/vuetify.js"></script> -->

    <!-- <script src="https://www.gstatic.com/firebasejs/5.3.1/firebase.js"></script> -->
    <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-firestore.js"></script>

    <script src="https://cdn.firebase.com/libs/firebaseui/3.3.0/firebaseui.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.3.0/firebaseui.css" />

    <script type="text/javascript">
      // Initialize Firebase
      const config = {
        apiKey: "AIzaSyDAx27-_XF2eM7wXiedd7goKm5p1fMONfs",
        authDomain: "moms-shuffleboard.firebaseapp.com",
        databaseURL: "https://moms-shuffleboard.firebaseio.com",
        projectId: "moms-shuffleboard",
        storageBucket: "moms-shuffleboard.appspot.com",
        messagingSenderId: "154777839060"
      };
      firebase.initializeApp(config);

      // FirebaseUI config.
      var uiConfig = {
        signInFlow: 'popup',
        signInSuccessUrl: '/',
        signInOptions: [
          // Leave the lines as is for the providers you want to offer your users.
          firebase.auth.GoogleAuthProvider.PROVIDER_ID,
          // firebase.auth.FacebookAuthProvider.PROVIDER_ID,
          // firebase.auth.TwitterAuthProvider.PROVIDER_ID,
          // firebase.auth.GithubAuthProvider.PROVIDER_ID,
          // firebase.auth.EmailAuthProvider.PROVIDER_ID,
          // firebase.auth.PhoneAuthProvider.PROVIDER_ID,
          // firebaseui.auth.AnonymousAuthProvider.PROVIDER_ID
        ],
        // tosUrl and privacyPolicyUrl accept either url string or a callback
        // function.
        // Terms of service url/callback.
        // tosUrl: '<your-tos-url>',
        // Privacy policy url/callback.
        // privacyPolicyUrl: function() {
        //   window.location.assign('<your-privacy-policy-url>');
        // }
      };

      // Initialize the FirebaseUI Widget using Firebase.
      var ui = new firebaseui.auth.AuthUI(firebase.auth());
      // The start method will wait until the DOM is loaded.
      if (ui.isPendingRedirect()) {
        ui.start('#firebaseui-auth-container', uiConfig);
      }
    </script>

    <style>
      table {
          border-collapse: collapse;
      }

      table, th, td {
          border: 1px solid black;
      }
    </style>

    <script type="text/x-template" id="schedule-template">
      <table style="border: 4px solid black;">
        <thead>
          <tr>
            <th></th>
            <th v-for="timeslot in timeslots">{{timeslot}}</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="date in dates">
            <td>{{date}}</td>
            <td v-for="timeslot in timeslots">
              <ul>
                <li v-for="team in schedule[date][timeslot]">
                  <ol>
                    <li>{{ getTeam(team).member_1 }}</li>
                    <li>{{ getTeam(team).member_2 }}</li>
                  </ol>
                </li>
              </ul>
            </td>
          </tr>
        </tbody>
      </table>
    </script>

    <script type="text/x-template" id="teams-template">
      <div>
        <ul>
        <li v-for="team, index of teams">
          <ol>
            <li>{{ team.member_1 }}</li>
            <li>{{ team.member_2 }}</li>
          </ol>
          <button v-on:click="onDelete(index)">delete</button>
        </li>
        </ul>

        <form v-on:submit.prevent="processForm">
          <input type="text" placeholder="First Team Member" v-model="form.member_1">
          <input type="text" placeholder="Second Team Member" v-model="form.member_2">
          <input type="submit">
        </form>

        <button @click="generateSchedule">Generate Schedule</button>
      </div>
    </script>



    <script type="text/javascript">
      let globalUser;

      initApp = function() {
        firebase.auth().onAuthStateChanged(function(user) {
          // store.commit('setUser', user);
          globalUser = user;

          if (user) {
            // User is signed in.
            var displayName = user.displayName;
            var email = user.email;
            var emailVerified = user.emailVerified;
            var photoURL = user.photoURL;
            var uid = user.uid;
            var phoneNumber = user.phoneNumber;
            var providerData = user.providerData;
            user.getIdToken().then(function(accessToken) {
              document.getElementById('sign-in-status').textContent = 'Signed in';
              document.getElementById('sign-in').textContent = 'Sign out';
              document.getElementById('account-details').textContent = JSON.stringify({
                displayName: displayName,
                email: email,
                emailVerified: emailVerified,
                phoneNumber: phoneNumber,
                photoURL: photoURL,
                uid: uid,
                accessToken: accessToken,
                providerData: providerData
              }, null, '  ');
            });
          } else {
            // User is signed out.
            document.getElementById('sign-in-status').textContent = 'Signed out';
            document.getElementById('sign-in').textContent = 'Sign in';
            document.getElementById('account-details').textContent = 'null';
          }
        }, function(error) {
          console.log(error);
        });
      };

      window.addEventListener('load', function() {
        initApp()
      });
    </script>




  </head>
  <body>
    <div id="app">
      <div id="firebaseui-auth-container"></div>

      <h1>Welcome to My Awesome App</h1>
      <div id="sign-in-status"></div>
      <div id="sign-in"></div>
      <div id="account-details"></div>

      <button @click="signin">Sign In</button>
      <button @click="signout">Sign Out</button>

      <h2>Router Links</h2>
      <router-link to="/">Schedule</router-link>
      <router-link to="/teams">Teams</router-link>
      <h2>Router Outlet</h2>
      <router-view v-bind:key="$route.fullPath"></router-view>
    </div>
  </body>

  <script type="module">
    import { Schedule } from './schedule.mjs';
    import { Teams } from './teams.mjs';
    import { store } from './store.mjs';

    const router = new VueRouter({
      mode: 'history',
      routes: [
        { path: '/', component: Schedule },
        { path: '/teams', component: Teams,
          // beforeEnter: (to, from, next) => {
          //   console.log('beforeEnter', globalUser);
          //   if (globalUser && globalUser.email === 'mark@oosterveld.org') {
          //     console.log('user', globalUser.email)
          //     next();
          //   } else {
          //     next('/');
          //   }
          // }
        }
      ]
    })

    const app = new Vue({
      el: '#app',
      router: router,
      store: store,
      components: { Schedule, Teams },
      computed: Vuex.mapState(['user']),
      methods: {
        signin: function() {
          ui.start('#firebaseui-auth-container', uiConfig);
        },
        signout: function() {
          console.log('signout')
          firebase.auth().signOut().then(function() {
            console.log('success')
            router.push('/');
          }, function(error) {
            console.log('error', error)
          });
        }
      }
    });

  </script>
</html>
